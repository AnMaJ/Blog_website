<!DOCTYPE html>
<html>
    <%- include('./partials/head.ejs')%>
    <body>
        <%- include('./partials/nav.ejs')%>
        <div class="Blogs content">
            <h2>
                SignUp Page
            </h2>
            <form class="create-user content">
                <label for="email">Email</label>
                <input type="text" name="email" required />
                <div class="email error"></div>

                <label for="password">Password</label>
                <input type="password" name="password" required />
                <div class="password error"></div>

                <label for="Username">Username</label>
                <input type="text" name="Username" required />
                <div class="username error"></div>

                <label for="age">Age</label>
                <input type="number" name="age" required />
                <div class="age error"></div>
                <button>SIGN UP</button>
            </form>
        </div>

        <script>
            const form=document.querySelector('form');
            const emailError=document.querySelector('.email.error');
            const passwordError=document.querySelector('.password.error');
            const usernameError=document.querySelector('.username.error');
            //const ageError=document.querySelector('.age.error');

            form.addEventListener('submit',async (e)=>{
                e.preventDefault();
                emailError.textContent='';
                passwordError.textContent='';
                usernameError.textContent='';
                //ageError.textContent='';
                const email=form.email.value;
                const password=form.password.value;
                const username=form.Username.value;
                const age=form.age.value;
                console.log(email, password, username, age);
                try{
                    const res=await fetch('/signup',{
                        method: 'POST',
                        body: JSON.stringify({email: email, password: password, username: username, age: age}),
                        headers: {'Content-Type': 'application/json'}
                    });
                    const data= await res.json();
                    console.log(data);
                    if(data.errors){
                        emailError.textContent=data.errors.email;
                        passwordError.textContent=data.errors.password;
                        usernameError.textContent=data.errors.username;
                        //ageError.textContent=data.errors.age;
                    }
                    if(data.user){
                        location.assign('/');
                    }
                }catch (e){
                    console.log(e);
                }
            })
        </script>
        <%- include("./partials/footer.ejs") %>
        <script src="" async defer></script>
    </body>
</html>